import {
	dehydrate,
	HydrationBoundary,
	QueryClient,
} from "@tanstack/react-query";
import HomePageContent from "@/components/HomePageContent";
import { settingQueries } from "@/queries/settingQueries";
import { versionsQueries } from "@/queries/versionsQueries";

export default async function Home(params: {
	searchParams: Promise<{ channel?: string; runtimeVersion?: string }>;
}) {
	const searchParams = await params.searchParams;
	const channel = searchParams.channel ?? "production";
	const runtimeVersion = searchParams.runtimeVersion;

	const queryClient = new QueryClient();

	const versionsQuery = versionsQueries.versions(channel);
	const settingQuery = settingQueries.detail();

	await Promise.all([
		queryClient.prefetchQuery({ ...versionsQuery }),
		queryClient.prefetchQuery({ ...settingQuery }),
	]);

	return (
		<HydrationBoundary state={dehydrate(queryClient)}>
			<HomePageContent channel={channel} runtimeVersion={runtimeVersion} />
		</HydrationBoundary>
	);
}
